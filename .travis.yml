language: common-lisp
sudo: required
os:
  - linux
  - osx

env:
  - LISP=sbcl-bin
  - LISP=ccl-bin

matrix:
  include:
    - env: LISP=sbcl/1.4.15
      os: linux
    - language: nix
      os: linux
      env:
      script: nix-build default.nix && echo -shcl-run-tests | ./result/bin/shcl
      install: true
  allow_failures:
    - env: LISP=sbcl-bin
      os: linux

install:
  - ./ci/install

script:
  - make LISP='ros -s cffi-grovel run --'
  - echo -shcl-run-tests | LD_LIBRARY_PATH="$(pwd):${LD_LIBRARY_PATH}" ./shcl
